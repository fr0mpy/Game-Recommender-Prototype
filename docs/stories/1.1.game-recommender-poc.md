# Story 1.1: Game Recommender POC Implementation

## Status
Draft

## Story
**As a** Bally's R&D team,
**I want** a complete Game Recommender POC that generates fictional slot games and provides similarity-based recommendations,
**so that** we can validate the feasibility of LLM-powered game recommendation systems for casino operations.

## Acceptance Criteria
1. System can generate 100 fictional slot games via LLM using the SlotForge prompt
2. Generated games are saved to structured JSON format matching the Game interface
3. Users can select a game from a dropdown interface
4. System calculates and displays 3-5 most similar games with confidence scores
5. Users can configure recommendation weights (theme, volatility, studio, mechanics)
6. System provides user-friendly explanations for each recommendation
7. Users can export game data in JSON and CSV formats
8. All interactions work through server-rendered pages with minimal client JavaScript
9. System handles errors gracefully with user-friendly messages
10. Application follows the ultra-lightweight architecture with only 4 core dependencies

## Tasks / Subtasks

### Phase 1: Project Foundation & File Operations
- [ ] Task 1: Initialize project structure (AC: 10)
  - [ ] Create project directory with package.json
  - [ ] Install dependencies: express, ejs, dotenv, openai
  - [ ] Create directory structure: data/, utils/, services/, views/, public/
  - [ ] Set up .env.example and .gitignore files
  - [ ] Create basic server.js entry point

- [ ] Task 2: Implement file-based storage utilities (AC: 2)
  - [ ] Create utils/storage.js with saveGames(), loadGames() functions
  - [ ] Add saveSettings(), loadSettings() with default weights
  - [ ] Implement error handling for file operations
  - [ ] Test file I/O operations with sample data

### Phase 2: LLM Integration & Game Generation  
- [ ] Task 3: Create game generation service (AC: 1, 2)
  - [ ] Implement services/gameGenerator.js with OpenAI integration
  - [ ] Use existing slot-game-generator-system-prompt.md file
  - [ ] Add JSON parsing with graceful error handling
  - [ ] Integrate with storage utilities to save generated games
  - [ ] Test generation with API key and validate output structure

### Phase 3: Similarity Engine & Recommendations
- [ ] Task 4: Build similarity calculation engine (AC: 4, 5)
  - [ ] Create services/similarityEngine.js with calculateSimilarity function
  - [ ] Implement theme matching (40% weight), volatility (30%), studio (20%), mechanics (10%)
  - [ ] Add getRecommendations function returning top 5 results with confidence scores
  - [ ] Implement caching for performance optimization
  - [ ] Test algorithm with sample game data

### Phase 4: Server-Side Rendering & UI
- [ ] Task 5: Create main application interface (AC: 3, 8)
  - [ ] Build views/index.ejs with game generation section
  - [ ] Add game selection dropdown populated from loaded games
  - [ ] Create weight configuration form with range inputs
  - [ ] Implement export links for JSON/CSV downloads
  - [ ] Style with Tailwind CSS via CDN

- [ ] Task 6: Build recommendations display (AC: 4, 6)
  - [ ] Create views/recommendations.ejs template
  - [ ] Display game cards with confidence scores and metadata badges
  - [ ] Show game details: title, studio, theme, volatility, RTP
  - [ ] Add back navigation to main interface
  - [ ] Implement responsive design for mobile devices

- [ ] Task 7: Create error handling pages (AC: 9)
  - [ ] Build views/error.ejs for user-friendly error display
  - [ ] Add views/partials/header.ejs and footer.ejs for consistency
  - [ ] Implement error middleware in server.js

### Phase 5: Express Routes & Application Logic
- [ ] Task 8: Implement core server routes (AC: 1, 3, 4, 8)
  - [ ] Create GET / route rendering home page with games and settings
  - [ ] Add POST /generate route for LLM game generation
  - [ ] Implement POST /recommend route for similarity calculations
  - [ ] Add error handling middleware with graceful degradation

- [ ] Task 9: Build export functionality (AC: 7)
  - [ ] Create services/csvConverter.js for CSV export
  - [ ] Add GET /export/json route with proper headers
  - [ ] Implement GET /export/csv route with CSV conversion
  - [ ] Test download functionality in browser

### Phase 6: Testing & Validation
- [ ] Task 10: Comprehensive testing and validation (AC: 9, 10)
  - [ ] Test game generation with valid/invalid API keys
  - [ ] Validate similarity calculations with edge cases
  - [ ] Test all user flows: generation, selection, recommendation, export
  - [ ] Verify error handling for malformed JSON, file system errors
  - [ ] Confirm responsive design on mobile devices
  - [ ] Validate performance with large datasets

## Dev Notes

### Architecture Context
**Source:** [docs/architecture/tech-stack.md] - Ultra-lightweight server-first architecture
- **Backend:** Express.js ^4.18.0 with EJS ^3.1.0 templates
- **Storage:** File-based JSON storage (no database)  
- **LLM:** OpenAI API ^4.0.0 for game generation
- **Styling:** Tailwind CSS via CDN
- **Dependencies:** Only 4 core dependencies (express, ejs, dotenv, openai)

### Data Models & Storage
**Source:** [.claude/docs/requirements.md#datasets] - Complete Game interface specification
```javascript
interface Game {
  id: string;
  title: string;
  studio: string;
  theme: string[];
  volatility: "low" | "medium" | "high" | "ultra";
  rtp: number;
  maxWin: number;
  reelLayout: string;
  paylines: number | "ways";
  mechanics: string[];
  features: string[];
  pace: "slow" | "medium" | "fast";
  hitFrequency: number;
  bonusFrequency: number;
  artStyle: string;
  audioVibe: string;
  visualDensity: "minimal" | "standard" | "busy";
  mobileOptimized: boolean;
  seasonalTag?: string;
  releaseYear: number;
  description: string;
}
```

**Storage Pattern:** [docs/architecture/coding-standards.md#file-storage-pattern]
- Use utils/storage.js functions exclusively
- saveGames(games) / loadGames() for game data
- saveSettings(settings) / loadSettings() for user preferences  
- Default weights: `{ theme: 0.4, volatility: 0.3, studio: 0.2, mechanics: 0.1 }`

### LLM Integration Specifications
**Source:** [.claude/docs/technical-specifications.md#llm-integration]
- **Model:** OpenAI GPT-4 Turbo (gpt-4-turbo-preview)
- **Token Limit:** 15000 for game generation
- **Temperature:** 0.8 for creativity vs consistency
- **Prompt:** Use existing `slot-game-generator-system-prompt.md` file
- **Error Handling:** Single attempt with graceful failure, no retries for POC

### Similarity Algorithm Requirements  
**Source:** [.claude/docs/requirements.md#recommendation-engine] + [docs/architecture/coding-standards.md#similarity-engine]
- **Theme matching:** 40% weight, exact match = 1.0, partial = 0.5
- **Volatility:** 30% weight, same level = 1.0, adjacent = 0.5  
- **Studio:** 20% weight, same studio = 1.0
- **Mechanics:** 10% weight, common features count
- **Output:** Top 5 results, confidence as percentage, no duplicates

### File Organization
**Source:** [docs/architecture/source-tree.md#project-structure]
```
├── server.js                    # Main Express application entry point
├── utils/storage.js              # File I/O operations (saveGames, loadGames, etc.)
├── services/
│   ├── gameGenerator.js          # LLM integration for game generation
│   ├── similarityEngine.js      # Recommendation calculation logic  
│   └── csvConverter.js           # CSV export functionality
├── views/
│   ├── index.ejs                 # Home page with game selection
│   ├── recommendations.ejs       # Recommendation results page
│   └── error.ejs                 # Error page template
├── data/
│   ├── games.json                # Generated slot games dataset
│   └── user-settings.json        # User weight preferences
```

### Required Code Patterns
**Source:** [docs/architecture/coding-standards.md#required-patterns]

**Route Handler Pattern:**
```javascript
app.post('/endpoint', async (req, res) => {
  try {
    const result = await businessLogicFunction(req.body);
    res.redirect('/success');
  } catch (error) {
    res.render('error', { error: error.message });
  }
});
```

**Error Handling Pattern:**
```javascript
try {
  const result = await riskyOperation();
  return result;
} catch (error) {
  console.error('Operation failed:', error);
  throw new Error('User-friendly message here');
}
```

### Performance & Caching
**Source:** [docs/architecture/coding-standards.md#performance-rules]
- Cache similarity calculations using gameCache Map
- Pre-load games once at startup, not per request
- Clear caches when they grow large for memory efficiency

### UI Standards  
**Source:** [docs/architecture/coding-standards.md#ui-standards]
- Server-rendered EJS templates with Tailwind CDN
- Form-based interactions with POST redirects
- Mobile-first responsive design
- Semantic HTML with proper ARIA labels
- Loading states for LLM generation
- Clear error messages with retry options

### Testing Requirements

**Source:** [docs/architecture/source-tree.md#testing-strategy]  
- **Manual Testing:** Browser testing for all user flows
- **Error Testing:** Invalid API keys, malformed JSON responses
- **Performance Testing:** Large datasets, concurrent users
- **File System Testing:** Missing files, permission errors

**Test Coverage Areas:**
- Game generation with valid/invalid API keys
- Similarity calculations with edge cases  
- All user flows: generation → selection → recommendation → export
- Error handling for JSON parsing failures
- Responsive design validation on mobile
- Performance with 100+ games dataset

### Environment Configuration
**Source:** [.claude/docs/technical-specifications.md#environment-variables]
```bash
# .env
PORT=3000
OPENAI_API_KEY=sk-...
NODE_ENV=development
```

### Forbidden Practices
**Source:** [docs/architecture/coding-standards.md#forbidden-practices]
- ❌ Direct fs.readFileSync() outside storage utils
- ❌ Complex client-side JavaScript  
- ❌ Runtime validation libraries
- ❌ Database dependencies
- ❌ Build processes or bundling
- ❌ External API calls beyond OpenAI

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 27.8.25 | 1.0 | Initial story creation with complete POC requirements | BMad Master |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References  
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_