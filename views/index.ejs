<%- include('partials/header', { title: 'Slot Forge - Home' }) %>

<div class="max-w-6xl mx-auto">
  <!-- Success/Error Messages -->
  <% if (message) { %>
  <div
    class="mb-6 p-4 rounded-lg <%= message.type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700' %> border"
  >
    <%= message.text %>
  </div>
  <% } %>

  <!-- Generate Games Section -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">
      📊 Game Dataset Generation
    </h2>
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 mb-2">
          Current dataset:
          <span class="font-bold text-casino"><%= games.length %></span> games
        </p>
        <p class="text-sm text-gray-500">
          Generate 100 fictional slot games using AI
        </p>
      </div>
      <div class="flex gap-3">
        <form method="POST" action="/generate" class="inline">
          <button
            type="submit"
            class="bg-casino hover:bg-casino-dark text-white font-bold py-2 px-4 rounded transition duration-200"
          >
            🤖 Generate Games
          </button>
        </form>
        <% if (games.length > 0) { %>
        <form method="POST" action="/generate-mock" class="inline">
          <button
            type="submit"
            class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded transition duration-200"
          >
            🧪 Add Mock Games
          </button>
        </form>
        <% } %>
      </div>
    </div>
  </div>

  <% if (games.length > 0) { %>
  <!-- Game Selection & Recommendation Section -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">
      🎯 Get Recommendations
    </h2>
    <form method="POST" action="/recommend" class="space-y-6">
      <!-- Game Selection -->
      <div>
        <label
          for="gameId"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Select a game to find similar games:
        </label>
        <select
          name="gameId"
          id="gameId"
          required
          class="w-full p-3 border border-gray-300 rounded-md focus:ring-casino focus:border-casino"
        >
          <option value="">Choose a game...</option>
          <% games.forEach(game => { %>
          <option value="<%= game.id %>">
            <%= game.title %> - <%= game.studio %> (<%= game.volatility %>
            volatility, <%= game.rtp %>% RTP)
          </option>
          <% }) %>
        </select>
      </div>

      <!-- Weight Configuration -->
      <div>
        <h3 class="text-md font-medium text-gray-700 mb-4">
          🎚️ Recommendation Weights
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div>
            <label
              for="theme"
              class="block text-sm font-medium text-gray-600 mb-1"
            >
              Theme Similarity
            </label>
            <input
              type="range"
              id="theme"
              name="theme"
              min="0"
              max="1"
              step="0.05"
              value="<%= settings.theme %>"
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
              oninput="updateSliderValue('theme', this.value)"
            />
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>0%</span>
              <span id="theme-value" class="font-semibold text-casino"
                ><%= Math.round(settings.theme * 100) %>%</span
              >
              <span>100%</span>
            </div>
          </div>

          <div>
            <label
              for="volatility"
              class="block text-sm font-medium text-gray-600 mb-1"
            >
              Volatility Matching
            </label>
            <input
              type="range"
              id="volatility"
              name="volatility"
              min="0"
              max="1"
              step="0.05"
              value="<%= settings.volatility %>"
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
              oninput="updateSliderValue('volatility', this.value)"
            />
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>0%</span>
              <span id="volatility-value" class="font-semibold text-casino"
                ><%= Math.round(settings.volatility * 100) %>%</span
              >
              <span>100%</span>
            </div>
          </div>

          <div>
            <label
              for="studio"
              class="block text-sm font-medium text-gray-600 mb-1"
            >
              Studio Preference
            </label>
            <input
              type="range"
              id="studio"
              name="studio"
              min="0"
              max="1"
              step="0.05"
              value="<%= settings.studio %>"
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
              oninput="updateSliderValue('studio', this.value)"
            />
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>0%</span>
              <span id="studio-value" class="font-semibold text-casino"
                ><%= Math.round(settings.studio * 100) %>%</span
              >
              <span>100%</span>
            </div>
          </div>

          <div>
            <label
              for="mechanics"
              class="block text-sm font-medium text-gray-600 mb-1"
            >
              Game Mechanics
            </label>
            <input
              type="range"
              id="mechanics"
              name="mechanics"
              min="0"
              max="1"
              step="0.05"
              value="<%= settings.mechanics %>"
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
              oninput="updateSliderValue('mechanics', this.value)"
            />
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>0%</span>
              <span id="mechanics-value" class="font-semibold text-casino"
                ><%= Math.round(settings.mechanics * 100) %>%</span
              >
              <span>100%</span>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-center">
        <button
          type="submit"
          class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 text-lg"
        >
          🔍 Find Similar Games
        </button>
      </div>
    </form>
  </div>

  <!-- Export Section -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">
      📁 Export Game Data
    </h2>
    <div class="flex items-center justify-between">
      <p class="text-gray-600">
        Download the current dataset for analysis or external use
      </p>
      <div class="flex gap-3">
        <a
          href="/export/json"
          class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-200"
        >
          📄 Download JSON
        </a>
        <a
          href="/export/csv"
          class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-200"
        >
          📊 Download CSV
        </a>
      </div>
    </div>
  </div>
  <% } else { %>
  <!-- Empty State -->
  <div class="bg-white rounded-lg shadow-md p-12 text-center">
    <div class="text-6xl mb-4">🎰</div>
    <h2 class="text-2xl font-semibold text-gray-800 mb-2">No Games Yet</h2>
    <p class="text-gray-600 mb-6">
      Generate your first dataset of 100 fictional slot games to get started
      with recommendations.
    </p>
    <form method="POST" action="/generate-mock" class="inline">
      <button
        type="submit"
        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded transition duration-200 mr-3"
      >
        🧪 Add Mock Games for Testing
      </button>
    </form>
  </div>
  <% } %>
</div>

<script>
  function updateSliderValue(sliderId, value) {
    const percentage = Math.round(value * 100);
    document.getElementById(sliderId + "-value").textContent = percentage + "%";
  }
</script>

<%- include('partials/footer') %>
